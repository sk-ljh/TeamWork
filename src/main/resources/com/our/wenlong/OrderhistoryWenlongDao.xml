<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wenlong.dao.OrderHistoryWenlongDao">

	<!-- 配置查询结果集和DO对象的映射关系 -->
	<!-- <resultMap type="FileInfoDO" id="filemap"> <id column="file_id" property="fileId"/> 
		<result column="file_name" property="fileName"/> <result column="file_url" 
		property="fileUrl"/> </resultMap> -->

	<!-- 历史订单查询 -->
	<select id="listOrderHistory" resultType="com.our.pojo.Order_history">
		select * from order_history where order_delete=0 and (payment_state=0 or payment_state=3)
	</select>
	
	<!-- 历史订单查询 -->
	<select id="getOrderHistoryAdmin" resultType="com.our.pojo.Order_history" parameterType="int">
		select * from order_history where order_id=#{order_id} and order_delete=0
	</select>
	
	<!-- 单笔订单查询 -->
	<select id="getOrderHistory" resultType="com.our.pojo.Order_history" parameterType="int">
		select * from order_history where order_id=#{order_id} and order_delete=0 and (payment_state=0 or payment_state=3)
	</select>
	
	<!-- 查询桌号 -->
	<update id="updatePaymentState" parameterType="int">
		update order_history set payment_state=3 where order_id=#{order_id}
	</update>
	
	<!-- 修改付款状态 -->
	<select id="getTableNumber" resultType="integer" parameterType="int">
		select table_number from order_history where order_delete=0 and payment_state=0 and order_id=#{order_id}
	</select>
	
	<!-- 添加历史订单 -->
	<insert id="insertOrderHistory" parameterType="com.our.pojo.Order_history">
		insert into order_history values(#{table_number},
										 #{total_price},
										 #{begin_time},
										 #{end_time},
										 #{payment_state},
										 #{order_id},
										 #{user_id},
										 #{order_delete})
	</insert>

</mapper>