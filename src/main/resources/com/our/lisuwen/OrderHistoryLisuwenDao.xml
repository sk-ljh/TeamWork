<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lisuwen.dao.OrderHistoryLisuwenDao">
	<!-- 配置查询结果集和DO对象的映射关系 -->
	<!-- <resultMap type="DepartmentInfoDO" id="departmentmap"> <id column="department_id" 
		property="departmentId"/>结果集中查询的department_id字段会被封装到DepartmentInfoDO对象的departmentId属性 
		<result column="department_name" property="departmentName"/> </resultMap> -->

	<!-- 查询未结账订单 -->
	<select id="listOrderHistory"
		resultType="com.our.pojo.Order_history">
		select * from order_history where payment_state > 0 order by payment_state
		DESC,begin_time DESC
	</select>

	<!-- 根据关键字查询订单 -->
	<select id="listOrderByKey" parameterType="String"
		resultType="com.our.pojo.Order_history">
		select
		table_number,total_price,begin_time,end_time,payment_state,order_id,user_id,order_delete
		from order_history
		where order_id like #{key} or user_id like #{key} or table_number like
		#{key} or total_price like #{key} or begin_time like "%"#{key}"%"
		or end_time like "%"#{key}"%" or payment_state like #{key}
	</select>

	<!-- 修改未结账订单 -->
	<update id="updateOrderHistory" parameterType="map">
		update
		order_history set
		end_time = #{end_time}, payment_state =
		#{payment_state}
		where order_id = #{order_id}
	</update>
	<!-- 修改桌号 -->
	<update id="updateTableNum" parameterType="int">
		UPDATE table_s
		,order_history SET table_s.table_status=0 where
		order_history.table_number = table_s.table_number and
		order_id=#{order_id}
	</update>

	<!-- 查看烹饪状态 -->
	<update id="updateCookState" parameterType="int">
		update order_list set
		cook_state=3 where order_id=#{order_id} and cook_state!=3
	</update>
</mapper>